====== NAO hraje hru s kostkou ======
===== Tım =====
**Adam Kugler**

**Jakub Koza**
===== Cíle =====
Jako cíl našeho projektu jsme si zvolili vytvoøit jednoduchou hru s kostkou, pro dva nebo více hráèù, kde by se NAO aktivnì úèastnil hry a zárovìn vyhodnocoval vısledky (rozpoznal, co na kostce padlo, a urèil vítìze). Náplní tohoto projektu bylo vytvoøit modul pro rozpoznávání hodnoty padlé na kostce, naplánovat pohyby a vše logicky sesadit dohromady v Choreographe.
===== Analıza =====
Pùvodní verze našeho projektu poèítala s vyuitím programu na rozpoznávání padlé hodnoty na kostce, kterou ji naprogramoval náš pøedchùdce Vojtìch Haur v jednom z pøedchozích semestrù. (link: https://edux.fit.cvut.cz/courses/MI-IVS/labs/mi_ivs_prj/rozpoznavani_kostky) Program byl celı napsán v programovacím jazyce Java, kterı ovládá robota pøes NAOqi's java binding, jinak známé jako JNaoQi. Bohuel pro naše úèely bylo potøeba kromì rozpoznávání kostky implementovat i motoriku robota, která by byla zbyteènì nároèná na implementaci v jazyce Java. Proto jsme se rozhodli, e vyuijeme nástroj Choreographe pro implementaci chování robota a celou èást rozpoznávání kostky implementujeme jako jeden modul, se kterım bude øešení v Choreographe pouze spolupracovat ve fázi, kdy je potøeba zjistit poèet bodù na kostce. Pro pouití tohoto øešení však bylo potøeba pøepsat rozpoznávání kostky, z Javy do C++ (pøípadnì Python), jeliko souèasné API neumoòuje napsání modulu v programovacím jazyce Java.
===== Øešení =====
Veškerá motorika robota je implementována pomocí nástroje Choreographe, ve kterém se funkcionalita zadává pomocí spojování urèitıch funkèních èástí do jistého druhu flow diagramu. Kadá funkèní èást mùe mít více vstupù i vıstupù, a dokonce mohou ve svém vıstupu posílat hodnotu v urèeném datovém typu. Vıhodou je, e lze vytvoøit vlastní funkèní celek za pomoci programovacího jazyka Python, kterı v tomto projektu pouíváme napøíklad pro napojení na námi vytvoøenı modul pro rozpoznávání poètu bodù na kostce (programovanı v C++), nebo také pro prùbìné pamatování vısledkù hodù a vyhodnocení hry.

Obecnì modul do robota NAO mùe bıt buï remote, nebo local. Remote znamená, e vlastní zdrojovı kód modulu bìí v poèítaèi, na kterém je remote modul spušìn a do robota je pouze nahrán proxy objekt, kterı poadavky deleguje skrze síové pøipojení na poèítaè za pomoci protokolu SOAP. Local modul bìí pøímo na robotovi a není tak potøeba ádnı pøenos po síti. Nevıhodou lokálního modulu je sloitìjší nasazování na robota, jeliko je nutné manuální pøekopírování do jeho pamìového uloištì napøíklad pomocí ssh. Pøepnutí mezi jednotlivımi typy modulù je pouze ve zmìnì konfiguraèního souboru pro kompilaci zdrojovıch kódù a je tedy nutné si pouze vybrat, zda pro rozpoznání vyuít vyššího vıkonu poèítaèe, avšak zpomalení na síti pøi pøenášení obrazu (remote modul), nebo zda nepøenášet po síti nic a nechat robota rozpoznat obraz na pomalejším procesoru robota. 

==== Rozpoznávání kostky ====
Celı modul pro rozpoznávání poètu bodù na kostce je programovanı v jazyce C++ za pouití knihovny pro pokroèilé zpracování obrazu OpenCV. Modul má název DieModule a jeho rozhraní poskytuje jedinou funkci s názvem findOutThrownCount, která nemá ádné parametry a návratovou hodnotou je èíslo typu int. Toto èíslo se rovná buï rozpoznané hodnotì bodù padlé na kostce, nebo hodnotì -1, která signalizuje, e kostka na obrázku nebyla správnì rozpoznána (teoreticky vrací i hodnotu 0 v pøípadì, e se modulu nepodaøilo poøídit fotku jeho spodní kamerou, avšak toto by v reálném pøípadì nemìlo nastat).

  

==== Rekvizity ====
=== Kostka ===
Plyšová bílá kostka s èervenımi puntíky, která je pøimìøenì veliká a mìkká, aby ji mohl robot uchopit.
=== Krabice ===
Krabice bez víka se zelenım vnitøkem a èernım vnìjškem. Slouí jako, podklad pro lepší rozpoznávání bez ohledu na prostøedí. Také zaruèuje, e kostka nepadne mimo zornı úhel robota.
== Správné umístìní krabice ==
Jakmile NAO stojí, je nutné umístit krabici tak, aby se robot dotıkal špièkami u nohou jejího delšího okraje, byla dnem na zemi a byla vycentrovaná na osu robota.
==== Pohyby v Choreographe ====
==== Logika v Choreographe ====
===== Vısledky =====
==== Hra ====
=== Princip hry ===
  * Hra pro 2 hráèe (NAO, èlovìk)
  * Oba hází kostkou do krabice
  * NAO rozpoznává, co padlo na kostce
  * Vyhrává ten kdo hodí víc
=== Prùbìh hry ===
  - NAO vysvìtlí pravidla hry
  - NAO je první na øadì
  - NAO poádá o podání kostky
  - Protihráè ho pohladí, kdy mu dá kostku
  - NAO uchopí kostku a hodí ji do krabice
  - NAO zaujme pozorovací pozici, poøídí snímek a rozpozná, co na kostce padlo
  - NAO øekne, co rozpoznal a oznámí protihráèi, e mùe házet
  - Protihráè hodí kostu do krabice a pohladí robota na znamení, e mùe zaèít rozpoznávat
  - NAO zaujme pozorovací pozici, poøídí snímek a rozpozná, co na kostce padlo
  - NAO øekne, co rozpoznal a oznámí protihráèi vısledek hry
  - Hra pokraèuje od bodu 2

  * Pokud dojde k chybì pøi rozpoznávání, NAO nevidí kostku, bude se hod opakovat
  * Pokud dojde k chybì pøi rozpoznávání a NAO špatnì vyhodnotí, co padlo, hra pokraèuje dál, jako by to bylo správnì. Nepøedpokládá se, e by se NAO spletl. 

==== Dílèí èásti ====
=== Modul pro rozpoznávání kostky ===
Modul, kterı je schopen, rozpoznat kostku zmiòovanou v èásti kostka, a urèit, kolik na ní padlo. Modul také pøedpokládá pouití krabice se zelenım vnitøkem a specifickou pozici robota. 

===== Moná rozšíøení =====



